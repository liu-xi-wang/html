<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Snake Game</title>
    <style>
      canvas {
        border: solid 1px #ccc;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="600" height="400"></canvas>
    <script>
      // 获取 canvas 元素
      var canvas = document.getElementById("canvas")
      // 获取上下文对象
      var ctx = canvas.getContext("2d")
      // 定义宽高
      var canvasWidth = canvas.width
      var canvasHeight = canvas.height
      // 定义蛇的初始位置和大小
      var snakeX = 100
      var snakeY = 100
      var snakeWidth = 20
      var snakeHeight = 20
      // 控制速度的变量
      var speedX = 0
      var speedY = 0
      // 定义食物的位置
      var foodX = 200
      var foodY = 200
      // 定义蛇的数组
      var snakeArray = []
      // 定义初始长度
      var snakeLength = 1
      // 定义初始化函数
      function init() {
        // 将蛇的坐标放入数组中
        for (var i = 0; i < snakeLength; i++) {
          snakeArray.push({ x: snakeX + i * snakeWidth, y: snakeY })
        }
        // 循环绘制蛇身体
        for (var i = 0; i < snakeArray.length; i++) {
          ctx.fillStyle = "green"
          ctx.fillRect(
            snakeArray[i].x,
            snakeArray[i].y,
            snakeWidth,
            snakeHeight
          )
        }
        // 绘制食物
        ctx.fillStyle = "red"
        ctx.fillRect(foodX, foodY, snakeWidth, snakeHeight)
      }
      // 执行初始化函数
      init()
      // 监听键盘事件
      document.onkeydown = function (event) {
        if (event.keyCode == 37) {
          // 左
          speedX = -snakeWidth
          speedY = 0
        } else if (event.keyCode == 38) {
          // 上
          speedY = -snakeHeight
          speedX = 0
        } else if (event.keyCode == 39) {
          // 右
          speedX = snakeWidth
          speedY = 0
        } else if (event.keyCode == 40) {
          // 下
          speedY = snakeHeight
          speedX = 0
        }
      }
      // 定义游戏主循环函数
      function gameLoop() {
        // 清除画布
        ctx.clearRect(0, 0, canvasWidth, canvasHeight)
        // 改变蛇的位置
        snakeX += speedX
        snakeY += speedY
        // 将蛇的新位置的坐标放入数组中
        snakeArray.push({ x: snakeX, y: snakeY })
        // 删除数组的前面元素，保持蛇的长度不变
        snakeArray.shift()
        // 检查蛇是否吃到了食物
        if (snakeX == foodX && snakeY == foodY) {
          snakeLength++
          foodX = Math.floor(Math.random() * canvasWidth)
          foodY = Math.floor(Math.random() * canvasHeight)
        }
        // 循环绘制蛇身体
        for (var i = 0; i < snakeArray.length; i++) {
          ctx.fillStyle = "green"
          ctx.fillRect(
            snakeArray[i].x,
            snakeArray[i].y,
            snakeWidth,
            snakeHeight
          )
        }
        // 绘制食物
        ctx.fillStyle = "red"
        ctx.fillRect(foodX, foodY, snakeWidth, snakeHeight)
        // 判断是否游戏结束
        if (
          snakeX < 0 ||
          snakeX >= canvasWidth ||
          snakeY < 0 ||
          snakeY >= canvasHeight
        ) {
          alert("Game Over!")
          clearInterval(gameInterval)
        } else {
          // 设置游戏速度
          setTimeout(gameLoop, 100)
        }
      }
      // 开始游戏
      var gameInterval = setInterval(gameLoop, 100)
    </script>
  </body>
</html>
